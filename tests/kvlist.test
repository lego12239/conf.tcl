lappend auto_path [pwd]/../
package require tcltest
package require conf

proc cb-1.0 {_conf _ctx op kname kval} {
	upvar #0 $_conf conf

	switch $op {
	=S -
	=L {
		dict set conf {*}$kname $kval
	}
	+=S {
		if {[dict exists $conf {*}$kname]} {
			set val [dict get $conf {*}$kname]
		} else {
			set val ""
		}
		append val $kval
		dict set conf {*}$kname $val
	}
	+=L {
		if {[dict exists $conf {*}$kname]} {
			set val [dict get $conf {*}$kname]
		} else {
			set val ""
		}
		lappend val {*}$kval
		dict set conf {*}$kname $val
	}
	"SECT_CH" -
	F {
	}
	}
}

tcltest::test kvlist-1.0 {
	simple key list-value pair
} -body {
	set ::conf ""
	conf::load_from_str {cb-1.0 ::conf} "k1=v1
	k1 = \[1 2 \[3\]\]"
	return $::conf
} -result {k1 {1 2 3}}

tcltest::test kvlist-1.1 {
	simple key list-value pair
} -body {
	set ::conf ""
	conf::load_from_str {cb-1.0 ::conf} "k1=v1
	k1 = \[1 2 \[3 4\]\]"
	return $::conf
} -result {k1 {1 2 {3 4}}}

tcltest::test kvlist-1.2 {
	simple key list-value pair
} -body {
	set ::conf ""
	conf::load_from_str {cb-1.0 ::conf} "k1=v1
	k1 = \[1
	2
	\[3
	4\]\]"
	return $::conf
} -result {k1 {1 2 {3 4}}}

tcltest::test kvlist-2.0 {
	key list-value pair and +=
} -body {
	set ::conf ""
	conf::load_from_str {cb-1.0 ::conf} "k1=v1
	k1 += v7
	k1 += v8"
	return $::conf
} -result {k1 v1v7v8}

tcltest::test kvlist-2.0.1 {
	key list-value pair and += without spaces
} -body {
	set ::conf ""
	conf::load_from_str {cb-1.0 ::conf} "k1=v1
	k1+=v7
	k1+=v8"
	return $::conf
} -result {k1 v1v7v8}

tcltest::test kvlist-2.1 {
	key list-value pair and +=
} -body {
	set ::conf ""
	conf::load_from_str {cb-1.0 ::conf} "k1=v1
	k1 += \[v7 v71 v72\]
	k1 += v8"
	return $::conf
} -result {k1 {v1 v7 v71 v72v8}}

tcltest::test kvlist-2.2 {
	key list-value pair and +=
} -body {
	set ::conf ""
	conf::load_from_str {cb-1.0 ::conf} "k1=\[v1 v12 v13\]
	k1 += v7
	k1 += v8"
	return $::conf
} -result {k1 {v1 v12 v13v7v8}}

tcltest::test kvlist-2.3 {
	key list-value pair and +=
} -body {
	set ::conf ""
	conf::load_from_str {cb-1.0 ::conf} "k1=\[v1 v12 v13\]
	k1 += v7
	k1 += \[v8 v81 v82\]
	k1 += v9"
	return $::conf
} -result {k1 {v1 v12 v13v7 v8 v81 v82v9}}

tcltest::test kvlist-2.4 {
	key list-value pair and +=
} -body {
	set ::conf ""
	conf::load_from_str {cb-1.0 ::conf} "k1+=\[v1 v12 v13\]
	k1 += v7
	k1 += \[v8 v81 v82\]
	k1 += v9"
	return $::conf
} -result {k1 {v1 v12 v13v7 v8 v81 v82v9}}

tcltest::test kvlist-2.5 {
	key list-value pair and +=
} -body {
	set ::conf ""
	conf::load_from_str {cb-1.0 ::conf} "k1+=v1
	k1 += v7
	k1 += v8"
	return $::conf
} -result {k1 v1v7v8}

tcltest::cleanupTests

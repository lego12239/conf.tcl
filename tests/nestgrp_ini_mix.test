lappend auto_path [pwd]/../
package require tcltest
package require conf

tcltest::test mix-1.0 {
	mix
} -body {
	conf::load_from_str "
	k=v
	\[a.b\]
	k1=v1
	l1.l2 \{
	  k2=v2
	  \[c.d\]
	  k3=v3
	  l3.l4 \{
	    k4=v4
	  \}
	  k5=v5
	\}
	k6=v6"
} -result {{k v a.b {k1 v1 l1.l2 {k2 v2 c.d {k3 v3 l3.l4 {k4 v4} k5 v5}} k6 v6}} {k . a.b {k1 . l1.l2 {k2 . c.d {k3 . l3.l4 {k4 .} k5 .}} k6 .}}}

tcltest::test mix-2.0 {
	mix
} -body {
	conf::load_from_str -hd . "
	k=v
	\[a.b\]
	k1=v1
	l1.l2 \{
	  k2=v2
	  \[c.d\]
	  k3=v3
	  l3.l4 \{
	    k4=v4
	  \}
	  k5=v5
	\}
	k6=v6"
} -result {{k v a {b {k1 v1 l1 {l2 {k2 v2 c {d {k3 v3 l3 {l4 {k4 v4}} k5 v5}}}} k6 v6}}} {k . a {b {k1 . l1 {l2 {k2 . c {d {k3 . l3 {l4 {k4 .}} k5 .}}}} k6 .}}}}

tcltest::test mix-3.0 {
	mix
} -body {
	conf::load_from_str -hd . "
	k=v
	\[a.b\]
	k1=v1
	\[a.c\]
	k2=v2
	\[d.e\]
	k3=v3
	l1.l2 \{
	  k4=v4
	  \[f.g\]
	  k5=v5
	  \[f.h\]
	  k6=v6
	  \[i.j\]
	  k7=v7
	  l3.l4 \{
	    k8=v8
	  \}
	  k9=v9
	\}
	k10=v10"
} -result {{k v a {b {k1 v1} c {k2 v2}} d {e {k3 v3 l1 {l2 {k4 v4 f {g {k5 v5} h {k6 v6}} i {j {k7 v7 l3 {l4 {k8 v8}} k9 v9}}}} k10 v10}}} {k . a {b {k1 .} c {k2 .}} d {e {k3 . l1 {l2 {k4 . f {g {k5 .} h {k6 .}} i {j {k7 . l3 {l4 {k8 .}} k9 .}}}} k10 .}}}}

tcltest::cleanupTests
